{{ with .Site.Data.supportSection }}
{{ if .enable }}
<section class="section support" id="support">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="support-section-title">I Miei Servizi</h2>
            </div>
        </div>
        <div class="row">
            {{ range $index, $card := .cards }}
            <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                <div class="support-card {{ if eq $card.id "psicologico" }}support-card-light{{ else }}support-card-dark{{ end }} {{ if eq $index 0 }}active{{ end }}" data-toggle="collapse" data-target="#collapse-{{ $card.id }}" aria-expanded="{{ if eq $index 0 }}true{{ else }}false{{ end }}" data-parent="#supportAccordion" style="background-image: url('{{ $card.image | absURL }}');">
                    <div class="support-card-overlay"></div>
                    <div class="support-card-header">
                        <h3 class="support-title">{{ $card.title }}</h3>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
        <div class="row">
            <div class="col-12">
                <div id="supportAccordion">
                    {{ range $index, $card := .cards }}
                    <div class="collapse support-collapse {{ if eq $index 0 }}show{{ end }}" id="collapse-{{ $card.id }}" data-parent="#supportAccordion">
                        <div class="support-content">
                            <div class="support-intro">
                                <p>{{ $card.description }}</p>
                            </div>
                            <div class="support-details">
                                <h4>Pu√≤ trattarsi di:</h4>
                                <div class="row mt-4">
                                    {{ range $card.items }}
                                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="support-item-card">
                                            <h5>{{ .title }}</h5>
                                            <p>{{ .content }}</p>
                                        </div>
                                    </div>
                                    {{ end }}
                                </div>
                            </div>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</section>
<script>
// prevent closing if already open and manage active state
document.addEventListener('DOMContentLoaded', function() {
    var supportCards = document.querySelectorAll('.support-card');
    
    supportCards.forEach(function(card) {
        card.addEventListener('click', function(e) {
            var targetId = this.getAttribute('data-target');
            var targetCollapse = document.querySelector(targetId);
            
            // if the clicked section is already open, prevent closing
            if (targetCollapse && targetCollapse.classList.contains('show')) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // remove active class from all cards
            supportCards.forEach(function(c) {
                c.classList.remove('active');
            });
            
            // add active class to clicked card
            this.classList.add('active');
        });
    });
});
</script>
{{ end }}
{{ end }}
